---
layout: single
title: "코드숨 5주차 과제1: 레스토랑 조회 구현하기"
# categories: Git
categories:
  - React # HTML CSS JavaScript Server Algorithm Wecodes Programmers CS Github Blog
tag: [리액트 기초, 리덕스] #tag는 여러개 가능함
toc: true #table of content 기능!
toc_sticky: true
author_profile: true #blog 글안에서는 author_profile이 따라다니지 않도록 설정함
date: 2022-09-10T09:50:00+09:00
# sidebar:
# nav: "docs" #네비게이션에 있는 docs를 의미함
---
<style>
.crimson {
  color: crimson;
  font-weight: bold;
}

.mediumblue {
  color: mediumblue;
  font-weight: bold;
}

.teal {
  color: teal;
  font-weight: bold;
}
</style>

# 코드숨 5주차 과제1: 레스토랑 조회 구현하기
# commit 기록
## (1) reducer에서 setRegions를 실행하기 위한 액션을 테스트
```jsx
// reducer.test.js
import reducer from './reducer';

import {
  setRegions,
} from './actions';

describe('reducer', () => {
  describe('setRegions', () => {
    it('changes regions', () => {
      const initialState = {
        regions: [],
      };

      const regions = [
        { id: 1, name: '서울' },
      ];

      const state = reducer(initialState, setRegions(regions));

      expect(state.regions).toHaveLength(1);
    });
  });
});
```

```jsx
// App.jsx
import { useEffect } from 'react';

import { useDispatch } from 'react-redux';

import {
  loadInitialData,
} from './actions';

// 0. 지역, 분류 목록을 얻기
// 1. 지역 선택 - Regions <- API
// 2. 분류 선택 - Category <- API
// 3. 식당 목록 - Restaurants <- API (with region, category)

function RegionsContainer() {
  return null;
}

function CategoriesContainer() {
  return null;
}

function RestaurantsContainer() {
  return null;
}

export default function App() {
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(loadInitialData());
  }, []);

  return (
    <div>
      <RegionsContainer />
      <CategoriesContainer />
      <RestaurantsContainer />
    </div>
  );
}
```

```jsx
// actions.js
export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}

export function loadInitialData() {
  return (dispatch) => {
    dispatch(setRegions(regions));
    // dispatch(setCategories(categories));
  };
}
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
};

export default function reducer(state = initialState, action) {
  return state;
}
```

```jsx
// store.js
import { applyMiddleware, legacy_createStore as createStore } from 'redux';

import thunk from 'redux-thunk';

import reducer from './reducer';

const store = createStore(reducer, applyMiddleware(thunk));

export default store;
```

## (2) reducer에서 setRegions를 실행하기 위한 액션을 구현
```jsx
// App.test.jsx
import { render } from '@testing-library/react';

import { useDispatch } from 'react-redux';

import App from './App';

test('App', () => {
  const dispatch = jest.fn();

  useDispatch.mockImplementation(() => dispatch);

  const { queryByText } = render((
    <App />
  ));

  expect(dispatch).toBeCalled();
  // expect(queryByText('Hello')).toBeNull();
});
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
};

export default function reducer(state = initialState, action) {
  if (action.type === 'setRegions') {
    const { regions } = action.payload;
    return {
      ...state,
      regions,
    };
  }

  return state;
}
```

## (3) reducer에서 setCategories를 실행하기 위한 액션을 테스트 및 구현
```jsx
// reducer.test.js
import reducer from './reducer';

import {
  setRegions,
  setCategories,
} from './actions';

describe('reducer', () => {
  describe('setRegions', () => {
    it('changes regions', () => {
      const initialState = {
        regions: [],
      };
      const regions = [
        { id: 1, name: '서울' },
      ];

      const state = reducer(
        initialState,
        setRegions(regions),
      );

      expect(state.regions).toHaveLength(1);
    });
  });

  describe('setCategories', () => {
    it('changes categories', () => {
      const initialState = {
        categories: [],
      };

      const categories = [
        { id: 1, name: '한식' },
      ];

      const state = reducer(
        initialState,
        setCategories(categories),
      );

      expect(state.categories).toHaveLength(1);
    });
  });
});
```

```jsx
// services/__mocks__api.js
export async function fetchRegions() {
  return [];
}

export async function fetchCategories() {
  return [];
}
```

```jsx
// services/api.js
export async function fetchRegions() {
  const url = 'https://eatgo-customer-api.ahastudio.com/regions';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}

export async function fetchCategories() {
  const url = 'https://eatgo-customer-api.ahastudio.com/categories';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
};
export default function reducer(state = initialState, action) {
  if (action.type === 'setRegions') {
    const { regions } = action.payload;
    return {
      ...state,
      regions,
    };
  }

  if (action.type === 'setCategories') {
    const { categories } = action.payload;
    return {
      ...state,
      categories,
    };
  }

  return state;
}
```

```jsx
// actions.js
import {
  fetchRegions,
  fetchCategories,
} from './services/api';

export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}

export function setCategories(categories) {
  return {
    type: 'setCategories',
    payload: { categories },
  };
}

export function loadInitialData() {
  return async (dispatch) => {
    const regions = await fetchRegions();
    dispatch(setRegions(regions));

    const categories = await fetchCategories();
    dispatch(setCategories(categories));
  };
}
```

## (4) reducer 컴포넌트에서 reducers 객체를 만들어 리팩터링
```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
};

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },

  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },
};

export default function reducer(state = initialState, action) {
  return reducers[action.type](state, action);
}
```

## (5) RegionsContainer 컴포넌트의 기본적인 렌더링을 위한 액션을 테스트 및 구현
```jsx
// RegionsContainer.test.jsx
import { render } from '@testing-library/react';

import RegionsContainer from './RegionsContainer';

test('RegionsContainer', () => {
  const { container } = render((
    <RegionsContainer />
  ));

  expect(container).toHaveTextContent('regions');
});
```

```jsx
// RegionsContainer.jsx
export default function RegionsContainer() {
  return (
    <div>
      regions
    </div>
  );
}
```

## (6) RegionsContainer 컴포넌트에서 비동기로 받아온 data를 화면에 렌더링하는 액션을 테스트 및 구현
```jsx
// RegionsContainer.test.jsx
import { render } from '@testing-library/react';

import { useSelector } from 'react-redux';

import RegionsContainer from './RegionsContainer';

test('RegionsContainer', () => {
  useSelector.mockImplementation((selector) => selector({
    regions: [
      { id: 1, name: '서울' },
    ],
  }));

  const { container } = render((
    <RegionsContainer />
  ));

  expect(container).toHaveTextContent('서울');
});
```

```jsx
// RegionsContainer.jsx
import { useSelector } from 'react-redux';

export default function RegionsContainer() {
  const regions = useSelector((state) => state.regions);

  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          {region.name}
        </li>
      ))}
    </ul>
  );
}
```

## (7) reducer 컴포넌트의 default 값을 추가하여 리팩터링
```jsx
// App.jsx
import { useEffect } from 'react';

import { useDispatch } from 'react-redux';

import RegionsContainer from './RegionsContainer'; // 추가

......
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
};
const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },
  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },
};

function defaultReducer(state) { // 추가
  return state; // 추가
}

export default function reducer(state = initialState, action) { 
  return (reducers[action.type] || defaultReducer)(state, action); // 추가
}
```

## (8) App 테스트 통과를 위해 useSelector를 추가하는 리팩터링
```jsx
// App.test.jsx
import { render } from '@testing-library/react';

import { useDispatch, useSelector } from 'react-redux'; // 추가

import App from './App';

test('App', () => {
  const dispatch = jest.fn();

  useDispatch.mockImplementation(() => dispatch);

  useSelector.mockImplementation((selector) => selector({  // 추가
    regions: [
      { id: 1, name: '서울' },
    ],
  }));

  const { queryByText } = render((
    <App />
  ));
  expect(dispatch).toBeCalled();
  // expect(queryByText('Hello')).toBeNull();
});
```

```jsx
// RegionsContainer.jsx
import { useSelector } from 'react-redux';
export default function RegionsContainer() {
  const regions = useSelector((state) => state.regions);

  function handleClick() { // 추가
    // TODO
  }

  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          <button // 추가
            type="button"
            onClick={handleClick}
          >
            {region.name}
          </button> 
        </li>
      ))}
    </ul>
```

## (9) 지역 버튼을 클릭했을 때 selectedRegion에 저장하기 위한 액션을 테스트 및 구현
```jsx
// RegionsContainer.test.jsx
import { fireEvent, render } from '@testing-library/react'; // add

import { useDispatch, useSelector } from 'react-redux'; // add

import RegionsContainer from './RegionsContainer';

test('RegionsContainer', () => {
  const dispatch = jest.fn();// add

  useSelector.mockImplementation((selector) => selector({
    regions: [
      { id: 1, name: '서울' },
    ],
  }));

  useDispatch.mockImplementation(() => dispatch); // add

  const { container, getByText } = render(( // add
    <RegionsContainer />
  ));

  expect(container).toHaveTextContent('서울');

  fireEvent.click(getByText('서울')); // add

  expect(dispatch).toBeCalled(); // add
});
```

```jsx
// reducer.test
import reducer from './reducer';
import {
  setRegions,
  setCategories,
  selectRegion, // add
} from './actions';

describe('reducer', () => {
  describe('setRegions', () => {
    it('changes regions', () => {
      const initialState = {
        regions: [],
      };
      const regions = [
        { id: 1, name: '서울' },
      ];
      const state = reducer(
        initialState,
        setRegions(regions),
      );
      expect(state.regions).toHaveLength(1);
    });
  });
  describe('setCategories', () => {
    it('changes categories', () => {
      const initialState = {
        categories: [],
      };
      const categories = [
        { id: 1, name: '한식' },
      ];
      const state = reducer(
        initialState,
        setCategories(categories),
      );
      expect(state.categories).toHaveLength(1);
    });
  });

  describe('selectRegion', () => { // add
    const initialState = {
      regions: [
        { id: 1, name: '서울' },
      ],
      selectedRegion: null,
    };

    const state = reducer(
      initialState,
      selectRegion(1),
    );

    expect(state.selectedRegion).toEqual(
      {
        id: 1,
        name: '서울',
      },
    );
  }); // add
});
```

```jsx
// RegionsContainer.jsx
import { useDispatch, useSelector } from 'react-redux'; // add

import { // add
  selectRegion,
} from './actions'; // add

export default function RegionsContainer() {
  const dispatch = useDispatch(() => dispatch); // add

  const regions = useSelector((state) => state.regions);

  function handleClick(regionId) { // add
    // TODO
    dispatch(selectRegion(regionId)); // add
  }

  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          <button
            type="button"
            onClick={() => handleClick(region.id)} // add
          >
            {region.name}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// actions.js
import {
  fetchRegions,
  fetchCategories,
} from './services/api';
export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}
export function setCategories(categories) {
  return {
    type: 'setCategories',
    payload: { categories },
  };
}

export function selectRegion(regionId) { // add
  return {
    type: 'selectRegion',
    payload: { regionId },
  };
} // add

export function loadInitialData() {
  return async (dispatch) => {
    const regions = await fetchRegions();
    dispatch(setRegions(regions));
    const categories = await fetchCategories();
    dispatch(setCategories(categories));
  };
}
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
  selectedRegion: null, // add
};

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },
  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },

  selectRegion(state, { payload: { regionId } }) { // add
    return {
      ...state,
      selectedRegion: state.regions.find((region) => region.id === regionId),
    };
  }, // add
};

function defaultReducer(state) {
  return state;
}
export default function reducer(state = initialState, action) {
  return (reducers[action.type] || defaultReducer)(state, action);
}
```

## (10) 지역 버튼을 클릭시 체크 표시가 화면에 렌더링 되도록 리팩터링
```jsx
// RegionsContainer.jsx
import { useDispatch, useSelector } from 'react-redux';
import {
  selectRegion,
} from './actions';
export default function RegionsContainer() {
  const dispatch = useDispatch(() => dispatch);

  const { regions, selectedRegion } = useSelector((state) => ({ // add
    regions: state.regions,
    selectedRegion: state.selectedRegion,
  })); // add

  function handleClick(regionId) {
    // TODO
    dispatch(selectRegion(regionId));
  }
  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          <button
            type="button"
            onClick={() => handleClick(region.id)}
          > 
            {region.name}
            {selectedRegion && region.id === selectedRegion.id ? '(V)' : null } // add
          </button>
        </li>
      ))}
    </ul>
  );
}
```

## (11) CategoriesContainer의 기본적인 렌더링을 위한 액션을 테스트 및 구현
```jsx
// CategoriesContainer.test.jsx
import { fireEvent, render } from '@testing-library/react';

import { useDispatch, useSelector } from 'react-redux';

import CategoriesContainer from './CategoriesContainer';

test('CategoriesContainer', () => {
  const dispatch = jest.fn();

  useSelector.mockImplementation((selector) => selector({
    categories: [
      { id: 1, name: '한식' },
    ],
  }));

  const { container, getByText } = render((
    <CategoriesContainer />
  ));

  expect(container).toHaveTextContent('한식');

  // fireEvent.click(getByText('한식'));

  // expect(dispatch).toBeCalled();
});
```

```jsx
// CategoriesContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import {
  setCategories,
} from './actions';

export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);

  const { categories, selectedCategory } = useSelector((state) => ({
    categories: state.categories,
    selectedCategory: state.selectedCategory,
  }));

  function handleClick(categoryId) {
    // dispatch(setCategories(categoryId));
  }

  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name}
            {selectedCategory
            && category.id === selectedCategory.id ? '(V)' : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// App.jsx
import { useEffect } from 'react';
import { useDispatch } from 'react-redux';

import RegionsContainer from './RegionsContainer';
import CategoriesContainer from './CategoriesContainer'; // add

import {
  loadInitialData,
} from './actions';
// 0. 지역, 분류 목록을 얻기
// 1. 지역 선택 - Regions <- API
// 2. 분류 선택 - Category <- API
// 3. 식당 목록 - Restaurants <- API (with region, category)

function RestaurantsContainer() {
  return null;
}

export default function App() {
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(loadInitialData(dispatch));
  }, []);
  return (
    <div>
      <RegionsContainer />
      <CategoriesContainer />
      <RestaurantsContainer />
    </div>
  );
}
```

## (12) App testdptj categories를 useSelector로 넘겨주는 액션을 리팩터링
```jsx
// App.test.jsx
import { render } from '@testing-library/react';

import { useDispatch, useSelector } from 'react-redux';

import App from './App';

test('App', () => {
  const dispatch = jest.fn();

  useDispatch.mockImplementation(() => dispatch);

  useSelector.mockImplementation((selector) => selector({
    regions: [
      { id: 1, name: '서울' },
    ],
    categories: [ // add
      { id: 1, name: '한식' },
    ], //  add
  }));

  const { queryByText } = render((
    <App />
  ));

  expect(dispatch).toBeCalled();

  expect(queryByText('서울')).not.toBeNull(); // add
  expect(queryByText('한식')).not.toBeNull(); // add
});
```

## (13) 카테고리 버튼을 클릭했을 때 selectedCategory에 저장하기 위한 액션을 테스트 및 구현
```jsx
// reducer.test.js
import reducer from './reducer';

import {
  setRegions,
  setCategories,
  selectRegion,
  selectCategory, // add
} from './actions';

describe('reducer', () => {
  describe('setRegions', () => {
    it('changes regions', () => {
      const initialState = {
        regions: [],
      };
      const regions = [
        { id: 1, name: '서울' },
      ];
      const state = reducer(
        initialState,
        setRegions(regions),
      );
      expect(state.regions).toHaveLength(1);
    });
  });
  describe('setCategories', () => {
    it('changes categories', () => {
      const initialState = {
        categories: [],
      };
      const categories = [
        { id: 1, name: '한식' },
      ];
      const state = reducer(
        initialState,
        setCategories(categories),
      );
      expect(state.categories).toHaveLength(1);
    });
  });
  describe('selectRegion', () => {
    const initialState = {
      regions: [
        { id: 1, name: '서울' },
      ],
      selectedRegion: null,
    };
    const state = reducer(
      initialState,
      selectRegion(1),
    );
    expect(state.selectedRegion).toEqual(
      {
        id: 1,
        name: '서울',
      },
    );
  });

  describe('selectCategory', () => { // add
    const initialState = {
      categories: [
        { id: 1, name: '한식' },
      ],
      selectedCategory: null,
    };

    const state = reducer(
      initialState,
      selectCategory(1),
    );

    expect(state.selectedCategory).toEqual(
      {
        id: 1,
        name: '한식',
      },
    );
  }); // add
});
```

```jsx
// CategoriesContainer.test.jsx
import { fireEvent, render } from '@testing-library/react';

import { useDispatch, useSelector } from 'react-redux';

import CategoriesContainer from './CategoriesContainer';

test('CategoriesContainer', () => {
  const dispatch = jest.fn();

  useSelector.mockImplementation((selector) => selector({
    categories: [
      { id: 1, name: '한식' },
    ],
  }));

  useDispatch.mockImplementation(() => dispatch); // add

  const { container, getByText } = render((
    <CategoriesContainer />
  ));

  expect(container).toHaveTextContent('한식');

  fireEvent.click(getByText('한식')); // add

  expect(dispatch).toBeCalled(); // add
});
```

```jsx
// actions.js
import {
  fetchRegions,
  fetchCategories,
} from './services/api';

export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}

export function setCategories(categories) {
  return {
    type: 'setCategories',
    payload: { categories },
  };
}

export function selectRegion(regionId) {
  return {
    type: 'selectRegion',
    payload: { regionId },
  };
}

export function selectCategory(categoryId) { // add
  return {
    type: 'selectCategory',
    payload: { categoryId },
  };
}  // add

export function loadInitialData() {
  return async (dispatch) => {
    const regions = await fetchRegions();
    dispatch(setRegions(regions));
    const categories = await fetchCategories();
    dispatch(setCategories(categories));
  };
}
```

```jsx
// CategoriesContainer.jsx
import { useDispatch, useSelector } from 'react-redux';
import {
  selectCategory,
} from './actions';
export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);
  const { categories, selectedCategory } = useSelector((state) => ({
    categories: state.categories,
    selectedCategory: state.selectedCategory,
  }));
  function handleClick(categoryId) {
    dispatch(selectCategory(categoryId));
  }
  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name} 
            {selectedCategory // delete
            && category.id === selectedCategory.id ? '(V)' : null} // delete
            {/* {selectedCategory //add
            && category.id === selectedCategory.id ? '(V)' : null} */}
            {selectedCategory ? (
              <>
                {category.id === selectedCategory.id ? '(V)' : null}
              </>
            ) : null} // add
          </button>
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
  selectedRegion: null,
  selectedCategory: null, // add
};

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },
  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },
  selectRegion(state, { payload: { regionId } }) {
    return {
      ...state,
      selectedRegion: state.regions.find((region) => region.id === regionId),
    };
  },

  selectCategory(state, { payload: { categoryId } }) { // add
    return {
      ...state,
      selectedCategory: state.categories.find((category) => category.id === categoryId),
    };
  }, // add
};

function defaultReducer(state) {
  return state;
}
export default function reducer(state = initialState, action) {
  return (reducers[action.type] || defaultReducer)(state, action);
}
```

## (14) reducer 컴포넌트의 reducers에서 반복되는 내용을 함수형 프로그래밍으로 리팩터링
```jsx
// reducer.js
const initialState = {
  regions: [],
  categories: [],
  selectedRegion: null,
  selectedCategory: null,
};

function equal(key, value) { // add
  return (obj) => obj[key] === value;
} // add

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },
  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },

  selectRegion(state, { payload: { regionId } }) {
    const { regions } = state; // add
    return {
      ...state,
      selectedRegion: state.regions.find((region) => region.id === regionId), // delete
      selectedRegion: regions.find(equal('id', regionId)), // add
    };
  },

  selectCategory(state, { payload: { categoryId } }) {
    const { categories } = state; // add
    return {
      ...state,
      selectedCategory: state.categories.find((category) => category.id === categoryId), // delete
      selectedCategory: categories.find(equal('id', categoryId)), // add
    };
  },
};
function defaultReducer(state) {
  return state;
}
export default function reducer(state = initialState, action) {
  return (reducers[action.type] || defaultReducer)(state, action);
}
```

## (15) CategoriesContainer의 useSelector 호출을 함수형 프로그래밍으로 리팩터링
```jsx
// CategoriesContainer.jsx
import { useDispatch, useSelector } from 'react-redux';
import {
  selectCategory,
} from './actions';

function get(key) { // add
  return (obj) => obj[key];
} // add

export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);

  const { categories, selectedCategory } = useSelector((state) => ({ // delete
    categories: state.categories,
    selectedCategory: state.selectedCategory,
  })); // delete

  const categories = useSelector(get('categories')); // add
  const selectedCategory = useSelector((state) => state.selectedCategory);

  // const categories = useSelector((state) => state.categories);
  // const selectedCategory = useSelector((state) => state.selectedCategory);

  // const { categories, selectedCategory } = useSelector((state) => ({
  //   categories: state.categories,
  //   selectedCategory: state.selectedCategory,
  // })); 
  // add

  function handleClick(categoryId) {
    dispatch(selectCategory(categoryId));
  }
  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name}
            {/* {selectedCategory
            && category.id === selectedCategory.id ? '(V)' : null} */}
            {selectedCategory ? (
              <>
                {category.id === selectedCategory.id ? '(V)' : null}
              </>
            ) : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

## (16) useSelector 안에서 호출되는 get 함수의 액션을 테스트 및 구현
```jsx
//  utils.js
export function get(key) { // add
  return (obj) => obj[key];
}

export function equal(key, value) {
  return (obj) => obj[key] === value;
} // add
```

```jsx
// utils.test.js
import { get, equal } from './utils';

test('get', () => {
  const state = {
    name: '홍길동',
  };

  const f = get('name');

  expect(f(state)).toBe('홍길동');
});
```

```jsx
// reducer.js
import { equal } from './utils'; // add

const initialState = {
  regions: [],
  categories: [],
  selectedRegion: null,
  selectedCategory: null,
};

function equal(key, value) { // delete
  return (obj) => obj[key] === value;
} // delete

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },
  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },
  selectRegion(state, { payload: { regionId } }) {
    const { regions } = state;
    return {
      ...state,
      selectedRegion: regions.find(equal('id', regionId)),
    };
  },
  selectCategory(state, { payload: { categoryId } }) {
    const { categories } = state;
    return {
      ...state,
      selectedCategory: categories.find(equal('id', categoryId)),
    };
  },
};
function defaultReducer(state) {
  return state;
}
export default function reducer(state = initialState, action) {
  return (reducers[action.type] || defaultReducer)(state, action);
}
```

```jsx
// CategoriesContainer.js
import { useDispatch, useSelector } from 'react-redux';
import {
  selectCategory,
} from './actions';

function get(key) { // delete
  return (obj) => obj[key];
} // delete

import { // add
  get,
} from './utils'; // add

export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);

  const categories = useSelector(get('categories'));
  const selectedCategory = useSelector((state) => state.selectedCategory);

  // delete
  // const categories = useSelector((state) => state.categories); 
  // const selectedCategory = useSelector((state) => state.selectedCategory);

  // const { categories, selectedCategory } = useSelector((state) => ({
  //   categories: state.categories,
  //   selectedCategory: state.selectedCategory,
  // }));
  // delete

  function handleClick(categoryId) {
    dispatch(selectCategory(categoryId));
  }
  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name}
            {/* {selectedCategory
            && category.id === selectedCategory.id ? '(V)' : null} */}
            {selectedCategory ? (
              <>
                {category.id === selectedCategory.id ? '(V)' : null}
              </>
            ) : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

## (17) utils의 get, equal 함수의 액션을 테스트 및 구현
```jsx
// utils.test.js
import { get, equal } from './utils';
test('get', () => {
  const state = {
    name: '홍길동',
  };

  const f = get('name');
  const g = get('age'); // add

  expect(f(state)).toBe('홍길동');
  expect(g(state)).toBeUndefined(); // add
});

test('equal', () => {
  const state = {
    name: '홍길동',
  };

  const f = equal('name', '홍길동');
  const g = equal('name', '임꺽정');

  expect(f(state)).toBeTruthy();
  expect(g(state)).toBeFalsy(); // add
});
```

```jsx
// CategoriesContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import { // delete
  selectCategory,
} from './actions'; // delete

import { selectCategory } from './actions'; // add

import { // delete
  get,
} from './utils'; // delete

import { get } from './utils'; // add

export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);

  const categories = useSelector(get('categories'));
  const selectedCategory = useSelector((state) => state.selectedCategory);

  function handleClick(categoryId) {
    dispatch(selectCategory(categoryId));
  }

  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name}
            {/* {selectedCategory
            && category.id === selectedCategory.id ? '(V)' : null} */}
            {selectedCategory ? (
              <>
                {category.id === selectedCategory.id ? '(V)' : null}
              </>
            ) : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// RegionsContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import { // delete
  selectRegion,
} from './actions'; // delete

import { selectRegion } from './actions'; // add

import { get } from './utils'; // add

export default function RegionsContainer() {
  const dispatch = useDispatch(() => dispatch);

  const { regions, selectedRegion } = useSelector((state) => ({ // delete
    regions: state.regions,
    selectedRegion: state.selectedRegion,
  })); // delete

  const regions = useSelector(get('regions')); // add
  const selectedRegion = useSelector(get('selectedRegion')); // add

  function handleClick(regionId) {
    // TODO
    dispatch(selectRegion(regionId));
  }
  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          <button
            type="button"
            onClick={() => handleClick(region.id)}
          >
            {region.name}
            {selectedRegion
              && region.id === selectedRegion.id ? '(V)' : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

## (18) Category 버튼 클릭시 loadRestaurants 함수를 호출하는 액션을 테스트 및 구현
```jsx
// ResetaurantsContainer.test.jsx
import { render } from '@testing-library/react'; // add

import { useDispatch, useSelector } from 'react-redux';

import RestaurantsContainer from './RestaurantsContainer';

test('RestaurantsContainer', () => {
  const dispatch = jest.fn();

  useDispatch.mockImplementation(() => dispatch);

  useSelector.mockImplementation((selector) => selector({
    restaurants: [
      { id: 1, name: '마법사주방' },
    ],
  }));

  const { container } = render((
    <RestaurantsContainer />
  ));

  expect(container).toHaveTextContent('마법사주방');
}); // add
```

```jsx
// reducer.test.js
import reducer from './reducer';

import {
  setRegions,
  setCategories,
  setRestaurants, // add
  selectRegion,
  selectCategory,
} from './actions';

describe('reducer', () => {
  describe('setRegions', () => {
    it('changes regions', () => {
      const initialState = {
        regions: [],
      };
      
      const regions = [
        { id: 1, name: '서울' },
      ];

      const state = reducer(
        initialState,
        setRegions(regions),
      );

      expect(state.regions).toHaveLength(1);
    });
  });

  describe('setCategories', () => {
    it('changes categories', () => {
      const initialState = {
        categories: [],
      };

      const categories = [
        { id: 1, name: '한식' },
      ];

      const state = reducer(
        initialState,
        setCategories(categories),
      );

      expect(state.categories).toHaveLength(1);
    });
  });

  describe('setRestaurants', () => { // add
    it('changes restaurants', () => {
      const initialState = {
        restaurants: [],
      };

      const restaurants = [
        { id: 1, name: '마법사주방' },
      ];

      const state = reducer(initialState, setRestaurants(restaurants));

      expect(state.restaurants).toHaveLength(1);
    });
  }); // add

  describe('selectRegion', () => {
    const initialState = { // delete
      regions: [
        { id: 1, name: '서울' },
      ],
      selectedRegion: null,
    };

    const state = reducer(
      initialState,
      selectRegion(1),
    );

    expect(state.selectedRegion).toEqual(
      {
        id: 1,
        name: '서울',
      },
    ); // delete
    it('changes selected region', () => { // add
      const initialState = {
        regions: [
          { id: 1, name: '서울' },
        ],
        selectedRegion: null,
      };

      const state = reducer(
        initialState,
        selectRegion(1),
      );

      expect(state.selectedRegion).toEqual(
        {
          id: 1,
          name: '서울',
        },
      );
    });
  }); // add

  describe('selectCategory', () => {
    const initialState = { // delete
      categories: [
        { id: 1, name: '한식' },
      ],
      selectedCategory: null,
    };

    const state = reducer(
      initialState,
      selectCategory(1),
    );

    expect(state.selectedCategory).toEqual(
      {
        id: 1,
        name: '한식',
      },
    ); // delete
    it('changes selected category', () => { // add
      const initialState = {
        categories: [
          { id: 1, name: '한식' },
        ],
        selectedCategory: null,
      };

      const state = reducer(
        initialState,
        selectCategory(1),
      );

      expect(state.selectedCategory).toEqual(
        {
          id: 1,
          name: '한식',
        },
      );
    }); // add
  });
});
```

```jsx
// RestaurantsContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import { selectRegion } from './actions';

import { get } from './utils';

export default function RestaurantsContainer() {
  const dispatch = useDispatch(() => dispatch);

  const restaurants = useSelector(get('restaurants'));

  return (
    <ul>
      {restaurants.map((restaurant) => (
        <li key={restaurant.id}>
          {restaurant.name}
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// services/api.js
export async function fetchRegions() {
  const url = 'https://eatgo-customer-api.ahastudio.com/regions';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}
export async function fetchCategories() {
  const url = 'https://eatgo-customer-api.ahastudio.com/categories';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}

export async function fetchRestaurants() { // add
  const url = 'https://eatgo-customer-api.ahastudio.com/restaurants';
  const response = await fetch(url);
  const data = await response.json();
  return data;
} // add
```

```jsx
// actions.js
import {
  fetchRegions,
  fetchCategories,
  fetchRestaurants, // add
} from './services/api';

export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}
export function setCategories(categories) {
  return {
    type: 'setCategories',
    payload: { categories },
  };
}

export function setRestaurants(restaurants) { // add
  return {
    type: 'setRestaurants',
    payload: { restaurants },
  };
} // add

export function selectRegion(regionId) {
  return {
    type: 'selectRegion',
    payload: { regionId },
  };
}
export function selectCategory(categoryId) {
  return {
    type: 'selectCategory',
    payload: { categoryId },
  };
}
export function loadInitialData() {
  return async (dispatch) => {
    const regions = await fetchRegions();
    dispatch(setRegions(regions));
    const categories = await fetchCategories();
    dispatch(setCategories(categories));
  };
}

export function loadRestaurants() { // add
  return async (dispatch) => {
    const restanurants = await fetchRestaurants();
    setRestaurants(restanurants);
  };
} // add
```

```jsx
// CategoriesContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import { selectCategory } from './actions'; // delete
import { // add
  selectCategory,
  loadRestaurants,
} from './actions'; // add

import { get } from './utils';

export default function CategoriesContainer() {
  const dispatch = useDispatch(() => dispatch);

  const categories = useSelector(get('categories'));
  const selectedCategory = useSelector((state) => state.selectedCategory);

  function handleClick(categoryId) {
    dispatch(selectCategory(categoryId));
    dispatch(loadRestaurants()); // add
  }

  return (
    <ul>
      {categories.map((category) => (
        <li key={category.id}>
          <button
            type="button"
            onClick={() => handleClick(category.id)}
          >
            {category.name}
            {/* {selectedCategory
            && category.id === selectedCategory.id ? '(V)' : null} */}
            {selectedCategory ? (
              <>
                {category.id === selectedCategory.id ? '(V)' : null}
              </>
            ) : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

```jsx
// reducer.js
import { equal } from './utils';

const initialState = {
  regions: [],
  categories: [],
  restaurants: [], // add
  selectedRegion: null,
  selectedCategory: null,
};

const reducers = {
  setRegions(state, { payload: { regions } }) {
    return {
      ...state,
      regions,
    };
  },

  setCategories(state, { payload: { categories } }) {
    return {
      ...state,
      categories,
    };
  },

  setRestaurants(state, { payload: { restaurants } }) { // add
    return {
      ...state,
      restaurants,
    };
  }, // add

  selectRegion(state, { payload: { regionId } }) {
    const { regions } = state;
    return {
      ...state,
      selectedRegion: regions.find(equal('id', regionId)),
    };
  },

  selectCategory(state, { payload: { categoryId } }) {
    const { categories } = state;
    return {
      ...state,
      selectedCategory: categories.find(equal('id', categoryId)),
    };
  },
};
function defaultReducer(state) {
  return state;
}
export default function reducer(state = initialState, action) {
  return (reducers[action.type] || defaultReducer)(state, action);
}
```

## (19) region 버튼과 category 버튼을 클릭시 fetchRestaurants 함수가 정상적으로 동작하도록 services/api.js를 리팩터링
```jsx
// services/__mocks__/api.js
export async function fetchRegions() {
  return [];
}
export async function fetchCategories() {
  return [];
}

export async function fetchRestaurants() {
  return [];
}
```

```jsx
// services/api.js
export async function fetchRegions() {
  const url = 'https://eatgo-customer-api.ahastudio.com/regions';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}
export async function fetchCategories() {
  const url = 'https://eatgo-customer-api.ahastudio.com/categories';
  const response = await fetch(url);
  const data = await response.json();
  return data;
}

export async function fetchRestaurants() { //delete
  const url = 'https://eatgo-customer-api.ahastudio.com/restaurants'; // delete
export async function fetchRestaurants({ regionName, categoryId }) { // add
  const url = 'https://eatgo-customer-api.ahastudio.com/restaurants'
  + `?region=${regionName}&category=${categoryId}`; // add
  const response = await fetch(url);
  const data = await response.json();
  return data;
}
```

```jsx
// actions.js
import {
  fetchRegions,
  fetchCategories,
  fetchRestaurants,
} from './services/api';

export function setRegions(regions) {
  return {
    type: 'setRegions',
    payload: { regions },
  };
}

export function setCategories(categories) {
  return {
    type: 'setCategories',
    payload: { categories },
  };
}

export function setRestaurants(restaurants) {
  return {
    type: 'setRestaurants',
    payload: { restaurants },
  };
}

export function selectRegion(regionId) {
  return {
    type: 'selectRegion',
    payload: { regionId },
  };
}

export function selectCategory(categoryId) {
  return {
    type: 'selectCategory',
    payload: { categoryId },
  };
}

export function loadInitialData() {
  return async (dispatch) => {
    const regions = await fetchRegions();
    dispatch(setRegions(regions));

    const categories = await fetchCategories();
    dispatch(setCategories(categories));
  };
}

export function loadRestaurants() {
  return async (dispatch) => { // delete
    const restanurants = await fetchRestaurants();
    setRestaurants(restanurants); // delete
  return async (dispatch, getState) => { // add
    const {
      selectedRegion: region,
      selectedCategory: category,
    } = getState();

    if (!region || !category) { return; }

    const restaurants = await fetchRestaurants({
      regionName: region.name,
      categoryId: category.id,
    });

    dispatch(setRestaurants(restaurants)); // add
  };
}
```

## (20) App test에서 useSelector로 전달되는 reataurants 배열을 추가하는 리팩터링
```jsx
// App.test.jsx
import { render } from '@testing-library/react';
import { useDispatch, useSelector } from 'react-redux';
import App from './App';
test('App', () => {
  const dispatch = jest.fn();
  useDispatch.mockImplementation(() => dispatch);
  useSelector.mockImplementation((selector) => selector({
    regions: [
      { id: 1, name: '서울' },
    ],
    categories: [
      { id: 1, name: '한식' },
    ],
    restaurants: [ // add
      { id: 1, name: '마법사주방' },
    ], // add
  }));

  const { queryByText } = render((
    <App />
  ));
  expect(dispatch).toBeCalled();
  expect(queryByText('서울')).not.toBeNull();
  expect(queryByText('한식')).not.toBeNull();
});
```

```jsx
// App.jsx
import { useEffect } from 'react';
import { useDispatch } from 'react-redux';

import RegionsContainer from './RegionsContainer';
import CategoriesContainer from './CategoriesContainer';
import RestaurantsContainer from './RestaurantsContainer'; // add

import {
  loadInitialData,
} from './actions';
// 0. 지역, 분류 목록을 얻기
// 1. 지역 선택 - Regions <- API
// 2. 분류 선택 - Category <- API
// 3. 식당 목록 - Restaurants <- API (with region, category)

function RestaurantsContainer() { // delete
  return null;
} // delete

export default function App() {
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(loadInitialData(dispatch));
  }, []);
  return (
    <div>
      <RegionsContainer />
      <CategoriesContainer />
      <RestaurantsContainer />
    </div>
  );
}
```

## (21) region 버튼을 클릭할 때도 restaurants 목록이 바뀌도록 리팩터링
```jsx
// RegionsContainer.jsx
import { useDispatch, useSelector } from 'react-redux';

import { selectRegion } from './actions'; // delete
import { // add
  selectRegion,
  loadRestaurants,
} from './actions'; // add

import { get } from './utils';

export default function RegionsContainer() {
  const dispatch = useDispatch(() => dispatch);
  const regions = useSelector(get('regions'));
  const selectedRegion = useSelector(get('selectedRegion'));

  function handleClick(regionId) {
    // TODO // delete
    dispatch(selectRegion(regionId));
    dispatch(loadRestaurants()); // add
  }

  return (
    <ul>
      {regions.map((region) => (
        <li key={region.id}>
          <button
            type="button"
            onClick={() => handleClick(region.id)}
          >
            {region.name}
            {selectedRegion
              && region.id === selectedRegion.id ? '(V)' : null}
          </button>
        </li>
      ))}
    </ul>
  );
}
```

<!-- ① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨-->

<!-- ### 2. Link 넣기

```

유형 1: (설명어를 입력) : [gunhee's coding blog](https://gunhee-jeong.github.io/)
유형 2: (URL 자동연결) : <https://gunhee-jeong.github.io/>
유형 3: (동일 파일 내 '문단으로 이동') : [1. Header로 이동](###-1-header)

```

유형 1: (설명어를 입력) : [gunhee's coding blog](https://gunhee-jeong.github.io/)
유형 2: (URL 자동연결) : <https://gunhee-jeong.github.io/>
유형 3: (동일 파일 내 '문단으로 이동') : [1. Header로 이동](#1-header)
유형 3의 방법

1. 특수문자를 제거
2. 스페이스는 -로 바꾸고
3. 대문자는 소문자로!
   그래서 ### 1. Header -> #1-header

## Link: [google][https://www.google.com/]

### 3. 수평선

```

---

```

---

### 4. 라인 바꾸기

```

스페이스바를 2번 눌러주면 다음칸으로
이동할 수 있어요!

```

---

스페이스바를 2번 눌러주면
다음칸으로 이동할 수 있어요!

### 5. list 만들기

```

1. 1번
2. 2번
3. 3번

- 순서없는 list
  - 순서없는 list
    - 순서없는 list

```

1. 1번
2. 2번
3. 3번

- 순서없는 list
  - 순서없는 list
    - 순서없는 list

---

### 6. font 관련

```

**진하게** -> 볼드
_기울여서_ -> 이탤릭체
~~취소선~~ -> 취소선

<ul>밑줄넣기</ul> -> 밑줄
<span style="color:red">빨간 글씨</span> -> 글자색
이것이 `인라인` 입니다 -> 인라인 코드
```

**진하게** -> 볼드
_기울여서_ -> 이탤릭체
~~취소선~~ -> 취소선
<u>밑줄넣기</u> -> 밑줄
<span style="color:red">빨간 글씨</span>
이것이 `인라인` 입니다 -> 인라인 코드

---

### 7. 인용구문

```
> coding
>
> > JavaScript
> >
> > > 내가 프짱!
```

> coding
>
> > JavaScript
> >
> > > 내가 프짱!

---

### 8. 이미지 삽입

```
유형1: ('사이즈를 조절' -> HTML 태그 사용) : <img src="https://gunhee-jeong.github.io/assets/images/blogLogo.png" width="300" height="200">
유형2: (이미지 삽입 후 -> 링크 걸기)
[![이미지](https://gunhee-jeong.github.io/assets/images/blogLogo/blogLogo.png)](https://gunhee-jeong.github.io/)
```

유형1: ('사이즈를 조절' -> HTML 태그 사용) : <img src="https://gunhee-jeong.github.io/assets/images/blogLogo.png" width="300" height="200">
유형2: (이미지 삽입 후 -> 링크 걸기)
[![이미지](https://gunhee-jeong.github.io/assets/images/blogLogo.png)](https://gunhee-jeong.github.io/)

### 9. 표 만들기

```
||국어|영어|
| :--- | ---: | :--: |
|건희 | 100점 | 100점
|철수 | 100점 | 100점
```

|      |  국어 | 영어  |
| :--- | ----: | :---: |
| 건희 | 100점 | 100점 |
| 철수 | 100점 | 100점 |

> - header를 넣고 싶은 경우 ---을 사용하고 :을 이용하여 정렬에 사용함!

### 10. 토글 만들기

```
<details>
<summary>여기를 누르세요</summary>
<div markdown="1">
숨겨진 내용
</div>
</details>
```

<details>
<summary>여기를 누르세요</summary>
<div markdown="1">
숨겨진 내용
</div>
</details> -->
